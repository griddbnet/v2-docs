# パラメータ

GridDBの動作を制御するパラメータについて説明します。GridDBのパラメータにはノードの設定情報や利用できるリソースなどの設定を行うノード定義ファイルと、クラスタの動作設定を行うクラスタ定義ファイルがあります。 定義ファイルの項目名と初期状態での設定値とパラメータの意味を説明します。

設定値の単位は以下のように指定します。

-   バイトサイズ: TB、GB、MB、KB、B、T、G、M、K、またはこれらの小文字表記で指定可能。特に記載のない限り、単位の省略はできません。

-   時間: h、min、s、msで指定可能。特に記載のない限り、単位の省略はできません。

　

## クラスタ定義ファイル（gs_cluster.json)


クラスタ定義ファイルは、クラスタを構成する全ノードで同一の設定にしておく必要があります。partitionNum,storeBlockSizeパラメータはデータベースの構造を決める重要なパラメータのため、GridDBの初期起動後は値の変更ができません。

クラスタ定義ファイルの各設定項目の意味を以下に説明します。

初期状態で含まれていない項目も項目名を追加することでシステムに認識させることができます。 変更の欄ではパラメータの変更可否と変更タイミングを示します
-   変更不可　：ノードを一度起動したのちは変更はできません。変更したい場合データベースを初期化する必要があります。
-   起動　　　：クラスタを構成する全ノードを再起動することで、変更できます。
-   オンライン：オンライン稼働中にパラメータを変更できます。ただし、変更内容は永続化されないため、定義ファイルの内容を手動で変更する必要があります。

　

| GridDBの構成                                 | 初期値    | パラメータの意味と制限値                          | 変更     |
|----------------------------------------------|-----------|--------------------------------------------------|----------|
| /notificationAddress                         | 239.0.0.1 | マルチキャストアドレスの標準設定です。cluster,transactionの同じ名前のパラメータが省略された場合、本設定が有効になります。異なる値が設定されている場合、個別設定のアドレスが有効です。 | 起動     |
| /dataStore/partitionNum                      | 128       | パーティション数を構成するクラスタ台数で分割配置できる公倍数で指定します。 整数: 1以上、10000以下で指定します。  | 変更不可 |
| /dataStore/storeBlockSize                    | 64KB      | ディスクI/Oのサイズ(64KB,1MB,4MB,8MB,16MB,32MB)を指定します。ブロックサイズを大きくすると１ブロックに格納できるレコードが増えるため、大規模テーブルのフルスキャンに向きますが、競合が発生する可能性が高くなります。システムにあったサイズを十分に検討して設定してください。サーバ起動後は変更できません。                                           | 変更不可 |
| /cluster/clusterName                         | なし      | クラスタを識別するための名称を指定します。必須入力のパラメータです。             | 起動     |
| /cluster/replicationNum                      | 2         | レプリカ数を指定します。レプリカ数が2の場合、パーティションが2重化されます。            | 起動     |
| /cluster/notificationAddress                 | 239.0.0.1 | クラスタ構成用マルチキャストアドレスを指定します。                     | 起動     |
| /cluster/notificationPort                    | 20000     | クラスタ構成用マルチキャストポートを指定します。 ポート番号として指定可能な範囲の値を指定します。 | 起動     |
| /cluster/notificationInterval                | 5秒       | クラスタ構成用マルチキャスト周期です。 1s以上、2<sup>31</sup>s未満の値を指定します。    | 起動     |
| /cluster/heartbeatInterval                   | 5秒       | クラスタ間でのノードの生存確認チェック周期（ハートビート周期）です。 1s以上、2<sup>31</sup>s未満の値を指定します。 | 起動     |
| /cluster/loadbalanceCheckInterval            | 180秒     | クラスタを構成するノード間の負荷バランス調整のため、バランス処理を実施するか否かのデータ採取周期を指定します。 1s以上、2<sup>31</sup>s未満の値を指定します。                                        | 起動     |
| /cluster/notificationMember                  | なし      | クラスタ構成方式を固定リスト方式にする際に、アドレスリストを指定します。           | 起動     |
| /cluster/notificationProvider/url            | なし      | クラスタ構成方式をプロバイダ方式にする際に、アドレスプロバイダのURLを指定します。  | 起動     |
| /cluster/notificationProvider/updateInterval | 5秒       | アドレスプロバイダからリストを取得する間隔を指定します。1s以上、2<sup>31</sup>s未満の値を指定します。  | 起動     |
| /sync/timeoutInterval                        | 30秒      | クラスタ間のデータ同期時のタイムアウト時間を指定します。　タイムアウトが発生した場合、システムの負荷が高い、障害発生などの可能性があります。 1s以上、2<sup>31</sup>s未満の値を指定します。     | 起動     |
| /transaction/notificationAddress             | 239.0.0.1 | クライアントが初期に接続するマルチキャストアドレスです。クライアントにはマスタノードが通知されます。     | 起動     |
| /transaction/notificationPort                | 31999     | クライアントが初期に接続するマルチキャストポートです。ポート番号として指定可能な範囲の値を指定します。   | 起動     |
| /transaction/notificationInterval            | 5秒       | クライアントへのマスタ通知用マルチキャスト周期。1s以上、2<sup>31</sup>s未満の値を指定します。          | 起動     |
| /transaction/replicationMode                 | 0         | トランザクションでデータ更新をする時のデータの同期（レプリケーション）方法を指定します。文字列または整数で、 "ASYNC"または0(非同期)、"SEMISYNC"または1(準同期)を指定します。            | 起動     |
| /transaction/replicationTimeoutInterval      | 10秒      | トランザクションが準同期レプリケーションでデータを同期する際のノード間通信のタイムアウト時間を指定します。1s以上、2<sup>31</sup>s未満の値を指定します。                             | 起動     |
| /transaction/authenticationTimeoutInterval   | 5秒       | 認証タイムアウト時間を指定します。                            | 起動       |
| /sql/notificationAddress                     | 239.0.0.1 | JDBCクライアントが初期に接続するマルチキャストアドレスです。クライアントにはマスタノードが通知されます。 | 起動     |
| /sql/notificationPort                        | 41999     | JDBCクライアントが初期に接続するマルチキャストポートです。ポート番号として指定可能な範囲の値を指定します。| 起動     |
| /sql/notificationInterval                    | 5秒       |JDBCクライアントへのマスタ通知用マルチキャスト周期です。1s以上、2<sup>31</sup>s未満の値を指定します。     | 起動     |

　

## ノード定義ファイル(gs_node.json)

ノード定義ファイルでは、クラスタを構成するノードのリソースを初期設定します。オンライン運用では、配置されているリソース、アクセス頻度などから、オンラインで値を変更できるパラメータもあります。逆に一度設定すると変更できない値(concurrency)もありますので注意してください。

ノード定義ファイルの各設定項目の意味を以下に説明します。

初期状態で含まれていない項目も項目名を追加することでシステムに認識させることができます。 変更の欄ではパラメータの変更可否と変更タイミングを示します
-   変更不可　：ノードを一度起動したのちは変更はできません。変更したい場合データベースを初期化する必要があります。
-   起動　　　：クラスタを構成する全ノードを再起動することで、変更できます。
-   オンライン：オンライン稼働中にパラメータを変更できます。ただし、変更内容は永続化されないため、定義ファイルの内容を手動で変更する必要があります。

ディレクトリの指定は、フルパスもしくは、GS_HOME環境変数からの相対パスで指定します。相対パスは、GS_HOMEの初期ディレクトリが基点となります。GS_HOMEの初期設定ディレクトリは、/var/lib/gridstoreです。

| GridDBの構成                         | 初期値                     | パラメータの意味と制限値     | 変更       |
|--------------------------------------|----------------------------|---------------------------------|-----|
| /serviceAddress                      | なし                       | cluster,transaction,syncの各サービスアドレスの初期値を設定。3項目のアドレスを設定せずに本アドレスの設定のみで各サービスアドレスの初期値を設定できる。  | 起動       |
| /dataStore/dbPath                    | data                       | データベースファイルの配置ディレクトリをフルパスもしくは、相対パスで指定する。   | 起動       |
| /dataStore/dbFileSplitCount          | 0 (分割無し)               | チェックポイントファイルの分割数。   | 不可       |
| /dataStore/dbFilePathList            | 空リスト                   | チェックポイントファイル分割時の分割チェックポイントファイルの配置ディレクトリリスト。<br>dbFileSplitCountに1以上を指定した場合は必須。複数設定可能(例：["/stg01","/stg02"])。ただし、dbFileSplitCount以上のディレクトリ数は指定不可。   | 起動   |
| /dataStore/backupPath                | backup                     | バックアップファイルの配置ディレクトリのパスを指定。                                  | 起動       |
| /dataStore/syncTempPath              | sync                       | データ同期用一時ファイルの配置ディレクトリのパスを指定。                                  | 起動       |
| /dataStore/storeMemoryLimit          | 1024MB                     | データ管理用メモリの上限。                                                       | オンライン |
| /dataStore/concurrency               | 4                          | 処理の並列度を指定。                                                                        | 不可       |
| /dataStore/logWriteMode              | 1                          | ログ書き出しモード・周期を指定。 -1または0の場合トランザクション終了時にログ書き込み、1以上2<sup>31</sup>未満の場合、秒単位の周期でログ書き込み  | 起動       |
| /dataStore/persistencyMode           | 1(NORMAL)                  | 永続化モードでは、データ更新時の更新ログファイルの保持期間を指定する。1(NORMAL)、2(RETAINING_ALL_LOGS)　のいずれかを指定。"NORMAL" は、チェックポイントにより、不要になったトランザクションログファイルは削除されます。"RETAINING_ALL_LOGS"は、全てのトランザクションログファイルを残します。 | 起動       |
| /dataStore/storeWarmStart            | false(無効)                | 再起動時にチャンクメモリ上限までインメモリ化するかを指定。                        | 起動       |
| /dataStore/affinityGroupSize         | 4                          | アフィニティグループ数                                                        | 起動       |
| /dataStore/storeCompressionMode      | NO_COMPRESSION   | データブロック圧縮モード                                                                | 起動       |
| /dataStore/autoExpire                | false                      | 期限解放が設定されたコンテナのロウを、コールドデータになった後に自動削除するかを指定。false:自動削除しない(長期アーカイブ実行による削除が必要) true:自動削除する                                                                                                            | オンライン |
| /checkpoint/checkpointInterval       | 60秒                       | メモリ上のデータ更新ブロックを永続化するチェックポイント処理の実行周期         | 起動       |
| /checkpoint/checkpointMemoryLimit    | 1024MB                     | チェックポイント専用書き出しメモリの上限 ※チェックポイント中に更新トランザクションがある場合に必要となるメモリ領域を上限値までプール。                                                                                                                                    | オンライン |
| /checkpoint/useParallelMode          | false(無効)                | チェックポイントを並列実行するかどうかを指定。※並列スレッド数は並列度(concurrency)と同じ数になります。| 起動       |
| /checkpoint/checkpointCopyInterval   | 100ms                      | データの更新や追加が行われたブロックをチェックポイント処理でディスクに出力する際の出力処理間隔        | 起動       |
| /cluster/serviceAddress              | 上位のserviceAddressに従う | クラスタ構成用待ち受けアドレス                                            | 起動       |
| /cluster/servicePort                 | 10010                      | クラスタ構成用待ち受けポート                                             | 起動       |
| /cluster/notificationInterfaceAddress  | ""                       | マルチキャストパケットを送信するインターフェースのアドレスを指定 | 起動       |
| /sync/serviceAddress                 | 上位のserviceAddressに従う | クラスタ間でデータ同期のための受信アドレス                                 | 起動       |
| /sync/servicePort                    | 10020                      | データ同期用待ち受けポート                                              | 起動       |
| /system/serviceAddress               | 上位のserviceAddressに従う | 運用コマンド用待ち受けアドレス                                           | 起動       |
| /system/servicePort                  | 10040                      | 運用コマンド用待ち受けポート                                            | 起動       |
| /system/eventLogPath                 | log                        | イベントログファイルの配置ディレクトリのパス                            | 起動       |
| /transaction/serviceAddress          | 上位のserviceAddressに従う | クライアント通信向けトランザクション処理用待ち受けアドレス(/transaction/localserviceAddressの指定がない場合、クラスタ内部通信向けも兼ねる)  | 起動       |
| /transaction/localServiceAddress     | 上位のserviceAddressに従う | クラスタ内部通信向けトランザクション処理用待ち受けアドレス  | 起動       |
| /transaction/servicePort             | 10001                      | トランザクション処理用待ち受けポート                                    | 起動       |
| /transaction/connectionLimit         | 5000                       | トランザクション処理接続数の上限                                       | 起動       |
| /transaction/transactionTimeoutLimit | 300秒                      | トランザクションタイムアウト時間の上限値                             | 起動       |
| /transaction/reauthenticationInterval  | 0s(無効)                 | 再認証間隔。(指定時間を超えると再認証が行われ、既に接続中の一般ユーザに対する権限等の変更が反映される。) デフォルト(0s)の場合、再認証は無効。| オンライン       |
| /transaction/workMemoryLimit         | 128MB                      | トランザクション処理でのデータ参照(get、TQL)時のメモリの上限サイズ(並列度ごと)       | オンライン       |
| /transaction/notificationInterfaceAddress | ""                    | マルチキャストパケットを送信するインターフェースのアドレスを指定                | 起動       |
| /sql/serviceAddress                  | 上位のserviceAddressに従う | クライアント通信向けNewSQL I/Fアクセスの処理用待ち受けアドレス(/sql/localServiceAddressの指定がない場合、クラスタ内部通信向けも兼ねる)   | 起動       |
| /sql/localServiceAddress             | 上位のserviceAddressに従う | クラスタ内部通信向けNewSQL I/Fアクセスの処理用待ち受けアドレス   | 起動       |
| /sql/servicePort                     | 20001                      | NewSQL I/Fアクセスの処理用待ち受けポート                             | 起動       |
| /sql/storeSwapFilePath               | swap                       | SQL中間ストアのスワップファイルの配置ディレクトリのパス                 | 起動       |
| /sql/storeSwapSyncSize               | 1024MB                     | SQL中間ストアのスワップファイルのsyncおよび物理メモリキャッシュ消去を行うサイズ  | 起動       |
| /sql/storeMemoryLimit                | 1024MB                     | SQL処理でメモリ上に保持する中間データの最大値                                 | 起動       |
| /sql/workMemoryLimit                 | 32MB                       | SQL処理でオペレータが使用するメモリの最大値                                   | 起動       |
| /sql/workCacheMemory                 | 128MB                      | SQL処理でオペレータが使用するメモリのうち、使用後に解放せずにキャッシュするメモリサイズ  | 起動       |
| /sql/connectionLimit                 | 5000                       | NewSQL I/Fアクセスの処理接続数の上限                                      | 起動       |
| /sql/concurrency                     | 4                          | 同時実行スレッド数                                                         | 起動       |
| /sql/traceLimitExecutionTime         | 300秒                      | スロークエリをイベントログに残す実行時間の下限値                           | オンライン |
| /sql/traceLimitQuerySize             | 1000                       | スロークエリに残るクエリ文字列のサイズ上限(バイト)                         | オンライン |
| /sql/notificationInterfaceAddress    | ""                         | マルチキャストパケットを送信するインターフェースのアドレスを指定                       | 起動       |
| /trace/fileCount                     | 30                         | イベントログファイルの上限数                                                 | 起動       |




システムの制限値
================

数値に関する制限
----------------

| ブロックサイズ                             | 64KB        | 1MB～32MB          |
|--------------------------------------------|-------------|-------------------|
| 文字列型/空間型のデータサイズ              | 31KB        | 128KB             |
| BLOB型のデータサイズ                       | 1GB - 1Byte | 1GB - 1Byte       |
| 配列長                                     | 4000        | 65000             |
| カラム数                                   | 1024個      | 約7K～32000個(※1) |
| 索引数(コンテナ1個あたり)                  | 1024個      | 16000個           |
| 線形補完圧縮の対象カラム数                 | 100個       | 100個             |
| ユーザ数                                   | 128         | 128               |
| データベース数                             | 128個       | 128個             |
| トリガのURL                                | 4KB         | 4KB               |
| アフィニティグループ数                     | 10000       | 10000             |
| 解放期限付き時系列コンテナの分割数         | 160         | 160               |
| GridDBノードが管理する通信バッファのサイズ | 約2GB       | 約2GB             |

| ブロックサイズ             | 64KB        | 1MB         | 4MB         | 8MB         | 16MB        | 32MB        |
|----------------------------|-------------|-------------|-------------|-------------|-------------|-------------|
| パーティションサイズ       | 約4TB       | 約64TB      | 約256TB     | 約512TB     | 約1PB       | 約2PB       |

- 文字列型、トリガのURL
  - 制限値はUTF-8エンコード相当
- 空間型
  - 制限値は内部格納形式相当
- (※1) カラム数
  - カラム数の上限には、固定長カラム(ブール型、整数型、浮動小数点数型、時刻型)の合計サイズが59KBまでという制約があります。この制約に当てはまらない場合は、カラム数の上限は32000個になります。
    - 例) LONG型カラムのみのコンテナの場合：カラム上限数は7552 ( 固定長カラムの合計サイズ 8B \* 7552 = 59KB )
    - 例) BYTE型カラムのみのコンテナの場合：カラム上限数は32000 ( 固定長カラムの合計サイズ 1B \* 32000 = 約30KB → 固定長カラムのサイズ制約には当てはまらないので、上限の32000個のカラムを作成できる)
    - 例) STRING型カラムのみのコンテナの場合：カラム上限数は32000 ( 固定長カラムのサイズ制約には当てはまらないので、上限の32000個のカラムを作成できる)

ネーミングに関する制限
----------------------

| 名前                   | 使用可能な文字                                     | 長さの上限                    |
|------------------------|----------------------------------------------------|-------------------------------|
| 管理ユーザ             | 先頭が"gs\#"で始まる。それ以外の文字は英数字、'\_' | 64文字                        |
| 一般ユーザ             | 英数字、'\_'、'-'、'.'、'/'、'='                   | 64文字                        |
| パスワード             | Unicodeコードポイントを文字とする<br>任意個数の文字の列(NULL文字(U+0000)は不可) | 64バイト(UTF-8エンコード換算) |
| クラスタ名             | 英数字、'\_'、'-'、'.'、'/'、'='                   | 64文字                        |
| データベース名         | 英数字、'\_'、'-'、'.'、'/'、'='                   | 64文字                        |
| コンテナ名<br>テーブル名<br>ビュー名 | 英数字、'\_'、'-'、'.'、'/'、'='<br>(ノードアフィニティを指定する場合のみ'@') | 16384文字(ブロックサイズ64KB)<br>131072文字(ブロックサイズ1MB～32MB) |
| カラム名               | 英数字、'\_'、'-'、'.'、'/'、'='                   | 256文字                       |
| 索引名                 | 英数字、'\_'、'-'、'.'、'/'、'='                   | 16384文字(ブロックサイズ64KB)<br>131072文字(ブロックサイズ1MB～32MB) |
| トリガ名               | 英数字、'\_'、'-'、'.'、'/'、'='                   | 256文字                       |
| バックアップ名         | 英数字、'\_'                                       | 12文字                        |
| データアフィニティ     | 英数字、'\_'、'-'、'.'、'/'、'='                   | 8文字                         |

- 大文字小文字の区別
  - クラスタ名・トリガ名・バックアップ名、パスワードは、大文字小文字の区別があります。したがって、例に示すような大文字小文字のみ異なる表記は、異なるものとして扱います。

    ``` sh
    例) trigger, TRIGGER
    ```

- それ以外の名前は、大文字小文字の区別がありません。大文字小文字表記は同一視します。
- 作成時に指定された大文字小文字の表記は、データとして保持します。
- TQL/SQL構文で名前を引用符"で囲う場合は、大文字小文字の表記を区別した検索を行います。

  ``` sh
  例) コンテナ名 SensorData の Column1 を検索する場合
      select "Column1" from "SensorData"   検索可能
      select "COLUMN1" from "SENSORDATA"  "SENSORDATA"というコンテナは存在しないので検索不可
  ```

- TQL/SQL構文での名前指定
  - 引用符"で囲わない場合は、英数字、'\_'(数字は先頭不可)の名前しか記述できません。それ以外の名前を記述する場合には引用符で囲んでください。
    ``` sh
    例) select "012column", data_15 from "container.2017-09"
    ```
